<!--
    divcensed under MIT license 2025, Anoduck, The Anonymous Duck
    https://anoduck.mit-license.org

    Hinode is a creation of The Hinode Team / I.E. Mark Dumay -> Of, which all credit and property rights are due.

    mod-popup is created by Anoduck, The Anonymous Duck
    Copyright � 2025 Anoduck, The Anonymous Duck; https://anoduck.mit-license.org
-->
<!--
    Copyright � 2024 The Hinode Team / Mark Dumay. All rights reserved.
    Use of this source code is governed by The MIT license (MIT) that can be found in the LICENSE file.
    Visit gethinode.com/license for more details.
-->

<!-- Check for valid arguments -->
{{- $error := false -}}

<!-- Initialize arguments -->
{{- $file := . -}}
{{- $title := "" -}}
{{- $btnlabel := "" -}}
{{- $image := "" -}}
{{- $alt := "" -}}
{{- $content := "" -}}

{{- $title = .Site.Params.modules.popup.title -}}
{{- $image = .Site.Params.modules.popup.image -}}
{{- $alt = .Site.Params.modules.popup.alt -}}
{{- $btnlabel = .Site.Params.modules.popup.btnlabel -}}
{{- $content = .Site.Params.modules.popup.content -}}

<script>
var css = ".img-replace{display:inline-block;overflow:hidden;text-indent:100%;color:transparent;white-space:nowrap;}.bts-popup{position:fixed;left:0;top:0;height:100%;width:100%;background-color:rgba(0,0,0,.5);opacity:0;visibility:hidden;-webkit-transition:opacity .3s 0s,visibility 0s .3s;-moz-transition:opacity .3s 0s,visibility 0s .3s;transition:opacity .3s 0s,visibility 0s .3s;}.bts-popup.is-visible{opacity:1;visibility:visible;-webkit-transition:opacity .3s 0s,visibility 0s 0s;-moz-transition:opacity .3s 0s,visibility 0s 0s;transition:opacity .3s 0s,visibility 0s 0s;}.bts-popup-container{position:relative;width:90%;max-width:400px;margin:4em auto;background:#a0cff1;border-radius:none;text-align:center;box-shadow:0 0 2px rgba(0,0,0,.2);-webkit-transform:translateY(-40px);-moz-transform:translateY(-40px);-ms-transform:translateY(-40px);-o-transform:translateY(-40px);transform:translateY(-40px);-webkit-backface-visibility:hidden;-webkit-transition-property:-webkit-transform;-moz-transition-property:-moz-transform;transition-property:transform;-webkit-transition-duration:.3s;-moz-transition-duration:.3s;transition-duration:.3s;}.bts-popup-container img{padding:20px 0 0 0;}.bts-popup-container p{color:white;padding:10px 40px;}.bts-popup-container .bts-popup-button{padding:5px 25px;border:2px solid white;display:inline-block;margin-bottom:10px;}.bts-popup-container a{color:white;text-decoration:none;text-transform:uppercase;}.bts-popup-container .bts-popup-close{position:absolute;top:8px;right:8px;width:30px;height:30px;}.bts-popup-container .bts-popup-close::before,.bts-popup-container .bts-popup-close::after{content: none;position:absolute;top:12px;width:16px;height:3px;background-color:white;}.bts-popup-container .bts-popup-close::before{-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg);left:8px;}.bts-popup-container .bts-popup-close::after{-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg);right:6px;top:13px;}.is-visible .bts-popup-container{-webkit-transform:translateY(0);-moz-transform:translateY(0);-ms-transform:translateY(0);-o-transform:translateY(0);transform:translateY(0);}@media only screen and (min-width:1170px){.bts-popup-container{margin:8em auto}}";

// injectCSS "borrowed" from tippy-bundle.umd.js
function injectCSS(css) {
	var style = document.createElement('style');
	style.textContent = css;
	var head = document.head;
	var styleTag = document.querySelector('head>style,head>link');

	if (styleTag) {
		head.insertBefore(style, styleTag);
	} else {
		head.appendChild(style);
	}
};

// Create content in reverse order
function createContent() {
	//create title
	let popupTitle = document.createElement('h1');
	popupTitle.innerHTML = {{ $title | safeJSStr }};

	//create image
	let popupImage = document.createElement('img');
	popupImage.setAttribute('src', {{ $image | safeJSStr }});
	popupImage.setAttribute('alt', {{ $alt | safeJSStr }});

	//create para
	let popupContent = document.createElement('p');
	popupContent.classList.add('popup-content');
	popupContent.innerHTML = {{ $content | safeJSStr }};

	//create button div
	let popupButtonDiv = document.createElement('div');
	popupButtonDiv.classList.add('bts-popup-button');

	//create button link
	let popupButtonLink = document.createElement('a');
	popupButtonLink.setAttribute('href', '#0')

	//create close element
	const popupCloseBtn = document.createElement('a');
	popupCloseBtn.setAttribute('href', '#0')
	popupCloseBtn.classList.add('bts-popup-close')
	popupCloseBtn.classList.add('img-replace')
	popupCloseBtn.innerHTML = {{ $btnlabel | safeJSStr }};

	//create container
	let popupContainer = document.createElement('div');
	popupContainer.classList.add('bts-popup-container');

	//create divPopup
	const divPopup = document.createElement('div');
	divPopup.classList.add('bts-popup');
	divPopup.ariaRoleDescription = 'alert';

	//start adding it all together
	divPopup.innerHTML = popupContainer;
	popupButtonDiv.innerHTML = popupButtonLink;
	popupContainer.innerHTML = popupTitle + popupImage + popupContent + popupButtonDiv + popupCloseBtn;

	// add content to page.
	var body = document.getElementsByTagName('body');
	body.innerHTML += divPopup;
};

// Main Function
document.addEventListener('DOMContentLoaded', function() {
	// Create the content
	injectCSS(css);
	createContent();

	// Open on load.
	const loadPopup = () => localStorage.getItem('hinode-popup');
	if (loadPopup === undefined || loadPopup != false) {
		localStorage.setItem('hinode-popup', true);
		setTimeout(() => {divPopup.classList.add('is-visible'); }, 1000);
	};

	// Close on click
	popupCloseBtn.addEventListener('click', function() {
		if ( popupCloseBtn ) {
			localStorage.setItem('hinode-popup', false);
			divPopup.classList.remove('is-visible');
			popupCloseBtn.removeEventListener('click', this);
		};
	});
});
</script>